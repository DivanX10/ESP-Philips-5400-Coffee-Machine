# ESP-Philips-5400-Coffee-Machine

Модификация и удаленное управление кофемашиной Philips 5400. Управление реализовано средствами ESPHome. Проект будет дорабатываться и дополняться новыми сведениями.

> Важно!
Все материалы этого проекта (прошивки, схемы, 3D модели и т.п.) предоставляются "КАК ЕСТЬ". Всё, что вы делаете с вашим оборудованием, вы делаете на свой страх и риск. Автор не несет ответственности за результат и ничего не гарантирует. Модификация кофемашины требует вмешательства, что лишит автоматически вас гарантии на новую кофемашину.

Вы можете принять участие в развитие проекта, например написать код для имитации счетчика чтобы можно было готовить кофе много раз, а не один раз после включения. Об этом будет написано ниже.

Что на текущий момент реализовано?

1) Разобрал протокол кофейных напитков и сенсоров
2) Реализовал удаленное включение и выключение
3) Написал код для вывода различных сенсоров и приготовления кофейного напитка
4) Отвод воды от носика

Что не реализовано? 
1) Написать код, который бы имитровал работу счетчка и можно было отправлять команду приготовление кофейного напитка много раз. Нужна помощь. Я не знаю как это сделать. Я не являюсь программистом и не имею опыта в реверсинжиниринге, это мой первый опыт и проект. Благодаря поддержки сообщества моего чата [Умный дом с Диваном](https://t.me/smart_home_divan) я смог расшифровать и реализовать удаленное управление кофемашиной


<details>
  <summary>Снимаем панель управления и встраиваем ESP</summary>
  

Снимаем панель управления. Снимается не сложно. Чуть тянем на себя, в эти точки вставляем пластиковую лопатку и вынимаем панель

![image](https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine/assets/64090632/37297b8c-7ed0-4eba-a87c-d1d52633bff0)

Нам нужен доступ к 8-ми жильному проводу, который нужно подключить к ESP. Подключаем по такой схеме. Сервопривод подключаем по желанию, он нужен для работы отвода воды от носика. 

![image](https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine/assets/64090632/41beae4d-7b4d-4d71-a93b-fa1ecb37ee06)


За включение и выключение кофемашины отвечает модуль реле одноканальный 5В (KY-019), которое имитирует нажатие на кнопку включения. Отмечу, что этот вариант лишает нас включать кофемашину через сенсорную кнопку. Возможно найдется другой вариант реализации включения кофемашины. Почему имено реле? На самом деле можно использовать и оптопару PC817C (см. вариант ниже)

![image](https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine/assets/64090632/a5c15cdc-0eab-42ed-9a51-42e8f614f382)


Схема подключения оптопары PC817C. Это тоже рабочий вариант, но есть но, нельзя вешать на GPIO ESP у которых при загрузке есть выходные сигналы, это будет включать кофемашину, а у реле такого нет, к какому бы вы GPIO не подключили, то при подключении в розетку, кофемашина не включится

![image](https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine/assets/64090632/262283be-e9d7-4294-9922-9b239c1d9ac3)
  
</details>



<details>
  <summary>Расшифровка протокола</summary>
  
Протокол кофейного напитка
![image](https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine/assets/64090632/a04845ff-e944-417e-9c2e-4f34a012ccc8)
![image](https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine/assets/64090632/c72aaee5-8630-458e-9adf-b1c1255909a1)


Протокол системных сенсоров
![image](https://github.com/DivanX10/ESP-Philips-5400-Coffee-Machine/assets/64090632/c24d8cdc-02ed-44eb-8b4b-5dc1f468412b)

</details>
